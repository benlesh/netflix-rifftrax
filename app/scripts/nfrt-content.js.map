{"version":3,"sources":["../scripts.babel/nfrt-content.js"],"names":[],"mappings":"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","file":"nfrt-content.js","sourcesContent":["const KNOWN_RIFFS = {\n  '1181616': {\n    name: 'Starship Troopers',\n    offset: 181.3,\n    videoVolume: 1\n  },\n  '60026347': {\n    name: 'Road House',\n    offset: 146.8,\n    videoVolume: 0.6\n  },\n  '1056189': {\n    offset: 124.6,\n    name: 'Top Gun',\n    videoVolume: 1\n  }\n};\n\nconst template = `<div id=\"nfrt\">\n  <button id=\"nfrt-showFind\">RiffTrax</button>\n  <div class=\"nfrt-dialog\">\n    <form id=\"nfrt-findForm\" name=\"findForm\">\n      <h3>Load RiffTrax</h3>\n\n      <div class=\"row\">\n        <label for=\"audioFile\">Audio File:</label>\n        <input type=\"file\" name=\"audioFile\" id=\"audioFile\" accept=\".mp3\" required/><br/>\n      </div>\n\n      <div class=\"row\">\n        <button id=\"nftr-load\" type=\"submit\">Load</button>\n      </div>\n    </form>\n  </div>\n  <audio style=\"display:none;\" id=\"nfrt-audio\"/>\n</div>`;\n\n\nconst content = document.createElement('div');\ncontent.innerHTML = template;\ndocument.body.appendChild(content);\ncontent.style.display = 'none';\n\nconst showFindButton = document.querySelector('#nfrt-showFind');\nconst dialog = document.querySelector('.nfrt-dialog');\nconst audioFileInput = document.querySelector('#audioFile');\nconst findForm = document.querySelector('#nfrt-findForm');\nconst audio = document.querySelector('#nfrt-audio');\n\nvar _ready = false;\nvar _offset = 0;\n\nfunction getMovieID() {\n  var href = window.location.href;\n  var matches = /netflix.com\\/watch\\/(\\d+)[\\/\\?]*/.exec(href);\n  if(matches) {\n    return matches[1];\n  }\n  return null;\n}\n\nfunction getRiff() {\n  var id = getMovieID();\n  return KNOWN_RIFFS[id];\n}\n\nshowFindButton.addEventListener('click', () => {\n  dialog.style.display = 'block';\n  showFindButton.style.display = 'none';\n});\n\nfindForm.addEventListener('submit', e => {\n  const audioURL = URL.createObjectURL(audioFileInput.files[0]);\n\n  console.log(getMovieID());\n  const riff = KNOWN_RIFFS[getMovieID()];\n\n  console.info('loaded riff: ' + riff.name);\n\n  _ready = true;\n  _offset = riff.offset;\n  audio.src = audioURL;\n  audio.currentTime = _offset;\n\n  e.preventDefault();\n\n  content.style.display = 'none';\n});\n\n\nfunction getVideoPlayer(callback) {\n  var video = document.querySelector('video');\n  if(!video) {\n    setTimeout(() => getVideoPlayer(callback), 10);\n  } else {\n    callback(video);\n  }\n}\n\ngetVideoPlayer(video => {\n  video.addEventListener('pause', function () {\n    if(!_ready) {\n      var riff = getRiff();\n      if(riff) {\n        video.volume = riff.videoVolume;\n        content.style.display = 'block';\n      }\n    }\n    audio.pause();\n  });\n\n  video.addEventListener('seeking', function () {\n    audio.pause();\n  });\n\n  video.addEventListener('seeked', function () {\n    if(_ready) {\n      var riff = getRiff();\n      if(!riff) {\n        _ready = false;\n        audio.pause();\n        return;\n      }\n      audio.currentTime = _offset + video.currentTime;\n      audio.play();\n    }\n  });\n\n  video.addEventListener('playing', function () {\n    content.style.display = 'none';\n    if (_ready) {\n      var riff = getRiff();\n      if(!riff) {\n        _ready = false;\n        audio.pause();\n        return;\n      }\n      video.volume = riff.videoVolume;\n      audio.currentTime = _offset + video.currentTime;\n      audio.play();\n    }\n  });\n\n\n  video.addEventListener('timeupdate', () => {\n    if(!audio.paused && _ready) {\n      const diff = Math.abs((video.currentTime) - (audio.currentTime - _offset));\n      if(diff > 0.09) {\n        console.log('resetting times');\n        audio.currentTime = video.currentTime + _offset;\n        audio.play();\n      }\n    }\n  });\n});\n"]}