{"version":3,"sources":["../scripts.babel/nfrt-content.js"],"names":[],"mappings":"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","file":"nfrt-content.js","sourcesContent":["const template = `<div id=\"nfrt\">\n  <button id=\"nfrt-showFind\">RiffTrax</button>\n  <div class=\"nfrt-dialog\">\n    <form id=\"nfrt-findForm\" name=\"findForm\">\n      <h3>Load RiffTrax</h3>\n\n      <label for=\"audioFile\">Audio File:</label>\n      <input type=\"file\" name=\"audioFile\" id=\"audioFile\" accept=\".mp3\" required/><br/>\n\n      <label for=\"syncFile\">Sync File:</label>\n      <input type=\"file\" name=\"syncFile\" id=\"syncFile\" accept=\".sync\"/><br/>\n\n      <div>\n        <button id=\"nftr-load\" type=\"submit\">Load</button>\n      </div>\n    </form>\n  </div>\n  <audio style=\"display:none;\" id=\"nfrt-audio\"/>\n</div>`;\n\n\nconst content = document.createElement('div');\ncontent.innerHTML = template;\ndocument.body.appendChild(content);\ncontent.style.display = 'none';\n\nfunction getSyncOffset(syncURL, callback) {\n  var xhr = new XMLHttpRequest();\n  xhr.onload = function syncLoaded() {\n    const syncData = xhr.responseText;\n    const parts = syncData.split('\\n');\n    var result = -3; // HACK: 3 second offset to get things lined up (unsure why).\n    for(var i = 0, len = parts.length; i < len; i++) {\n      var innerParts = parts[i].split('=');\n      if (innerParts[0] === 'riffdelay_init' || innerParts[0] === 'time_offset') {\n        result += +innerParts[1];\n      }\n    }\n    callback(result);\n  };\n  xhr.open('GET', syncURL);\n  xhr.send();\n}\n\nconst showFindButton = document.querySelector('#nfrt-showFind');\nconst dialog = document.querySelector('.nfrt-dialog');\nconst audioFileInput = document.querySelector('#audioFile');\nconst syncFileInput = document.querySelector('#syncFile');\nconst findForm = document.querySelector('#nfrt-findForm');\nconst audio = document.querySelector('#nfrt-audio');\n\nvar _video = null;\nvar _ready = false;\nvar _offset = 0;\n\nshowFindButton.addEventListener('click', () => {\n  dialog.style.display = 'block';\n  showFindButton.style.display = 'none';\n});\n\nfindForm.addEventListener('submit', e => {\n  const audioURL = URL.createObjectURL(audioFileInput.files[0]);\n  const syncURL = URL.createObjectURL(syncFileInput.files[0]);\n\n  getSyncOffset(syncURL, (offset) => {\n    _ready = true;\n    _offset = offset;\n    audio.src = audioURL;\n    audio.currentTime = offset;\n  });\n\n  e.preventDefault();\n\n  content.style.display = 'none';\n});\n\n\nfunction getVideoPlayer(callback) {\n  var video = document.querySelector('video');\n  if(!video) {\n    setTimeout(() => getVideoPlayer(callback), 10);\n  } else {\n    callback(video);\n  }\n}\n\n\ngetVideoPlayer(video => {\n  _video = video;\n\n  video.addEventListener('pause', function () {\n    if(!_ready) {\n      content.style.display = 'block';\n    }\n    audio.pause();\n  });\n\n  video.addEventListener('seeking', function () {\n    audio.pause();\n  });\n\n  video.addEventListener('seeked', function () {\n    if(_ready) {\n      audio.currentTime = _offset + _video.currentTime;\n      audio.play();\n    }\n  });\n\n  video.addEventListener('playing', function () {\n    content.style.display = 'none';\n    if (_ready) {\n      audio.currentTime = _offset + _video.currentTime;\n      audio.play();\n    }\n  });\n\n\n  video.addEventListener('timeupdate', () => {\n    if(!audio.paused && _ready) {\n      const diff = Math.abs((video.currentTime) - (audio.currentTime - _offset));\n      if(diff > 0.09) {\n        console.log('resetting times');\n        audio.currentTime = video.currentTime + _offset;\n        audio.play();\n      }\n    }\n  });\n});\n"]}